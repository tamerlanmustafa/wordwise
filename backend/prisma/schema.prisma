generator client {
  provider             = "prisma-client-py"
  recursive_type_depth = "5"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int               @id @default(autoincrement())
  email              String            @unique(map: "ix_users_email") @db.VarChar
  username           String            @unique(map: "ix_users_username") @db.VarChar
  passwordHash       String?           @map("password_hash") @db.VarChar
  languagePreference String?           @map("language_preference") @db.VarChar
  proficiencyLevel   proficiencylevel? @map("proficiency_level")
  isActive           Boolean?          @map("is_active")
  isAdmin            Boolean?          @map("is_admin")
  createdAt          DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime?         @updatedAt @map("updated_at") @db.Timestamptz(6)
  oauthProvider      oauthprovider     @map("oauth_provider")
  googleId           String?           @unique(map: "ix_users_google_id") @map("google_id") @db.VarChar
  profilePictureUrl  String?           @map("profile_picture_url") @db.VarChar
  wordLists          UserWordList[]

  @@index([id], map: "ix_users_id")
  @@map("users")
}

model Movie {
  id              Int              @id @default(autoincrement())
  title           String           @db.VarChar
  year            Int
  genre           String?          @db.VarChar
  difficultyLevel difficultylevel? @map("difficulty_level")
  script_text     String?
  wordCount       Int?             @map("word_count")
  description     String?
  poster_url      String?          @db.VarChar
  createdAt       DateTime?        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime?        @updatedAt @map("updated_at") @db.Timestamptz(6)
  words           Word[]
  movieScripts    MovieScript[]

  @@index([id], map: "ix_movies_id")
  @@index([title], map: "ix_movies_title")
  @@map("movies")
}

model MovieScript {
  id                 Int          @id @default(autoincrement())
  movieId            Int          @map("movie_id")
  sourceUsed         scriptsource @map("source_used")
  rawScriptText      String?      @map("raw_script_text")
  cleanedScriptText  String?      @map("cleaned_script_text")
  wordCount          Int?         @map("word_count")
  cleanedWordCount   Int?         @map("cleaned_word_count")
  isTruncated        Boolean      @default(false) @map("is_truncated")
  isComplete         Boolean      @default(true) @map("is_complete")
  processingMetadata String?      @map("processing_metadata")
  fetchedAt          DateTime     @default(now()) @map("fetched_at") @db.Timestamptz(6)
  createdAt          DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt          DateTime     @updatedAt @map("updated_at") @db.Timestamptz(6)
  movie              Movie        @relation(fields: [movieId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([movieId])
  @@index([movieId], map: "ix_movie_scripts_movie_id")
  @@index([sourceUsed], map: "ix_movie_scripts_source")
  @@map("movie_scripts")
}

model Word {
  id               Int              @id @default(autoincrement())
  word             String           @db.VarChar
  definition       String?
  difficulty_level difficultylevel?
  frequency        Float?
  part_of_speech   String?          @db.VarChar
  example_sentence String?
  translation      String?          @db.VarChar
  movieId          Int?             @map("movie_id")
  userWordLists    UserWordList[]
  movie            Movie?           @relation(fields: [movieId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([id], map: "ix_words_id")
  @@index([word], map: "ix_words_word")
  @@map("words")
}

model UserWordList {
  id       Int       @id @default(autoincrement())
  userId   Int       @map("user_id")
  wordId   Int       @map("word_id")
  listType listtype  @map("list_type")
  added_at DateTime? @default(now()) @db.Timestamptz(6)
  user     User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  word     Word      @relation(fields: [wordId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([id], map: "ix_user_word_lists_id")
  @@map("user_word_lists")
}

model alembic_version {
  version_num String @id(map: "alembic_version_pkc") @db.VarChar(32)
}

enum difficultylevel {
  BEGINNER
  ELEMENTARY
  INTERMEDIATE
  UPPER_INTERMEDIATE
  ADVANCED
  PROFICIENT
}

enum listtype {
  LEARN_LATER
  FAVORITES
  MASTERED
}

enum oauthprovider {
  email
  google
  facebook
}

enum proficiencylevel {
  A1
  A2
  B1
  B2
  C1
  C2
}

enum scriptsource {
  STANDS4_PDF
  STANDS4_API
  SUBTITLE_SRT
  SUBTITLE_VTT
  SYNOPSIS
  MANUAL_UPLOAD
}
